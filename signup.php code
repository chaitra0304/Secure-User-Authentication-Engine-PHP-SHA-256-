<?php

$username = $_POST['username'];
$password = $_POST['password'];
$confirm = $_POST['confirm'];

if ($password !== $confirm) {
    die("❌ Passwords do not match");
}

$hash = hash("sha256", $password);

$file = "users.csv";

// Create CSV if not exists
if (!file_exists($file)) {
    $fp = fopen($file, "w");
    fputcsv($fp, ["Username", "PasswordHash"]);
    fclose($fp);
}

// Check if username already exists
$fp = fopen($file, "r");
while (($row = fgetcsv($fp)) !== false) {
    if ($row[0] === $username) {
        fclose($fp);
        die("❌ Username already exists");
    }
}
fclose($fp);

// Save user
$fp = fopen($file, "a");
fputcsv($fp, [$username, $hash]);
fclose($fp);

echo "✅ Yayy! Signup successful. You can now login.";
?>
